<!doctype html> 
<html> 
<head> 
    <title> Comp20 Final Project</title>
    <meta name="author" content="Raina Mak"> 
    <meta charset="utf-8"/> 
    <style>
        body{background-color:beige;}
    
    </style>
    <script> 
        /*-- use AJAX data pattern to send a request to the API, tetreive some data, and display the data
        */
        function loadData(city){
            request = new XMLHttpRequest(); 
            request.open("GET", "https://app.ticketmaster.com/discovery/v2/events.json?classificationName=music&city=" + city + "&apikey=IRf1McTms041EqaYu7WMVAtq6JuW4WQd",true); 
            request.onreadystatechange= function(){
                if(request.readyState == 4 && request.status ==200){
                    var result = request.response; 
                    events = JSON.parse(result);
                    /*data for names of events are an located in an array of objects called events. each object has key "name" with value artist name*/
                    var array_Artists = []; 
                    event_array = events["_embedded"]["events"]; 
                    event_array.forEach(function(item){
                        array_Artists.push("<li>" + item["name"]+"</li>");   
                    }) 
                    document.getElementById("data").innerHTML=array_Artists; 
                    
                }else if (request.readyState == 4 && request.status!= 200){
                    document.getElementById("data").innerHTML="Error"; 
                }
            }
            request.send();
        }
    
        function processData(){
            var city = document.getElementById("city").value 
            if (city!=""){
                document.write(city);
                loadData(city); 
            }
        }
        
        // function show_searches() {
        //     var request = new XMLHttpRequest();
        //     request.open("GET", "app.js");
        //     request.onreadystatechange= function(){
        //         if(request.readyState == 4 && request.status ==200){
        //             var result = request.response; 
        //             result_array = JSON.parse(result);
        //             /*data for names of events are an located in an array of objects called events. each object has key "name" with value artist name*/
        // 
        //             document.getElementById("data").innerHTML = result_array; 
        // 
        //         }else if (request.readyState == 4 && request.status!= 200){
        //             document.getElementById("data").innerHTML="Error"; 
        //         }
        //     }
        //     request.send();
        // }
    
    </script>
    
</head>

<body> 
    <!-- 
    key: IRf1McTms041EqaYu7WMVAtq6JuW4WQd
    API Call Format 
    https://app.ticketmaster.com/{package}/{version}/{resource}.json?apikey=**{API key}
    https://developer.ticketmaster.com/products-and-docs/apis/discovery-api/v2/
    --> 
    
    <!-- displaying list of music events--> 
    <h1 style="text-align: center;">Music events in Boston:</h1>
    <div id="data" style="text-align: center;">Loading...</div>
    
    <div id="searchHome">
    <form method = "POST" action = "/submit-form">
      <select name="menu">
          <option value= "0" selected>Select</option>
          <option value= "1">Artist</option>
          <option value= "2" >Genre</option>
          <option value= "3" >City</option>
      </select>
      <input type="text" name="search_value">
      <input type="submit" name = "recent_search" value="Display Recent Searches" onclick = "processData()">
      <input type="submit" name = "search"value="Search" onclick = "processData()">
    </form>
  </div>
  
  <div name = "search_data"> </div>


</body>
</html>
