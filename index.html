<!doctype html> 
<html> 
<head> 
    <title> Comp20 Final Project</title>
    <meta name="author" content="Raina Mak"> 
    <meta charset="utf-8"/> 
    <style>
        body{
              background-color:beige;
             text-align: center;
        }
    
    </style>
    <script> 
        /*-- use AJAX data pattern to send a request to the API, tetreive some data, and display the data
        */
        function loadData(city){
            request = new XMLHttpRequest(); 
            request.open("GET", "https://app.ticketmaster.com/discovery/v2/events.json?classificationName=music&city=" + city + "&apikey=IRf1McTms041EqaYu7WMVAtq6JuW4WQd",true); 
            request.onreadystatechange= function(){
                if(request.readyState == 4 && request.status ==200){
                    var result = request.response; 
                    events = JSON.parse(result);
                    /*data for names of events are an located in an array of objects called events. each object has key "name" with value artist name*/
                    var array_Artists = []; 
                    event_array = events["_embedded"]["events"]; 
                    event_array.forEach(function(item){
                        array_Artists.push("<li>" + item["name"]+"</li>");   
                    }) 
                    document.getElementById("data").innerHTML=array_Artists; 
                    
                }else if (request.readyState == 4 && request.status!= 200){
                    document.getElementById("data").innerHTML="Error"; 
                }
            }
            request.send();
        }
    
        function processData(){
            var city = document.getElementById("city").value 
            if (city!=""){
                document.write(city);
                loadData(city); 
            }
        }
        
        function display_recent_searches() {
            console.log('display recent searches');
            if(document.getElementById("menu").value == 1) {
                fetch('/display-artist-searches', {method: 'GET'})
                  .then(function(response) {
                      if(response.ok) return response.json();
                      throw new Error('Request failed.');
                  })
                  .then(function(data) {
                      document.getElementById('recent_search_display').innerHTML = JSON.stringify(data);
                  })
                  .catch(function(error) {
                    console.log(error);
                  });
            }
            else if (document.getElementById("menu").value == 2) {
                fetch('/display-genre-searches', {method: 'GET'})
                  .then(function(response) {
                      if(response.ok) return response.json();
                      throw new Error('Request failed.');
                  })
                  .then(function(data) {
                      document.getElementById('recent_search_display').innerHTML = JSON.stringify(data);
                  })
                  .catch(function(error) {
                    console.log(error);
                  });
            }
            else if (document.getElementById("menu").value == 3) {
                fetch('/display-city-searches', {method: 'GET'})
                  .then(function(response) {
                      if(response.ok) return response.json();
                      throw new Error('Request failed.');
                  })
                  .then(function(data) {
                      document.getElementById('recent_search_display').innerHTML = JSON.stringify(data);
                  })
                  .catch(function(error) {
                    console.log(error);
                  });
            }
            
        }
      
    
    </script>
    
</head>

<body> 
    <!-- 
    key: IRf1McTms041EqaYu7WMVAtq6JuW4WQd
    API Call Format 
    https://app.ticketmaster.com/{package}/{version}/{resource}.json?apikey=**{API key}
    https://developer.ticketmaster.com/products-and-docs/apis/discovery-api/v2/
    --> 
    
    <!-- displaying list of music events--> 
    <h1 style="text-align: center;">Music events in Boston:</h1>
    <div id="data" style="text-align: center;">Loading...</div>
    
    <div id="searchHome">
    <form method = "POST" action = "/submit-form">
      <select name="menu" id = "menu" onchange = "return display_recent_searches()" method = "post">
          <option value= "0" selected>Select</option>
          <option value= "1">Artist</option>
          <option value= "2" >Genre</option>
          <option value= "3" >City</option>
      </select>
      <input type="text" name="search_value">
      <input type="submit" id = "search" name = "search"value="Search" onclick = "processData()">
    </form>
  </div>
  <h2> Recent Searches: </h2>
  <div id = "recent_search_display"> </div>


</body>
</html>